<!-- chat.component.html -->
<div class="chat-container flex flex-col">
    <div class="chat-wrapper" [ngClass]="{ centered: messages.length === 0 }">
        <div class="chat-header">
            <h1 class="chat-title">Chat History</h1>
        </div>

        <p-scrollPanel #scrollPanel class="chat-window">
            <div *ngFor="let msg of messages" class="chat-message" [ngClass]="msg.role">
                <!-- Conversation header -->
                <div *ngIf="msg.isConversationHeader" class="conversation-header">
                    <div class="conversation-title" [innerHTML]="msg.content"></div>
                </div>

                <!-- Regular message -->
                <p-card *ngIf="!msg.isConversationHeader" [ngClass]="msg.role === 'user' ? 'user-bubble' : 'bot-bubble'">
                    <div class="message-content" [innerHTML]="msg.content | formatText"></div>
                    <div *ngIf="msg.role === 'assistant'" class="message-meta">
                        <!-- <small *ngIf="msg.contextData.contextUsed !== undefined">
                            {{ msg.contextData?.contextUsed ? 'Used context' : 'No context used' }}
                        </small> -->
                    </div>
                </p-card>
            </div>
        </p-scrollPanel>

        <div *ngIf="loading" class="loading-indicator">
            <i class="pi pi-spinner pi-spin"></i>
        </div>

        <div class="chat-input">
            <input pInputText [(ngModel)]="input" placeholder="Send a message..." (keyup.enter)="sendMessage()" />
            <button pButton icon="pi pi-send" (click)="sendMessage()"></button>
        </div>
    </div>
</div>
